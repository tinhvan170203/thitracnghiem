import{r as h,j as e,S as L,s as N,I as E,c as P,a as $,b as z,u as A,F,d as a,L as R,e as v,B as C,o as j,f as Q,h as se,g as ce,i as he}from"./index-7ef6efc8.js";import{S as de,P as me}from"./PaginationComponent-f7f78972.js";import{d as O}from"./Add-cf6b960a.js";import{q as pe}from"./base-312a79a2.js";import{D as ue}from"./DialogDelete-828592e2.js";import"./axiosCommon-148f8bc3.js";import{d as W}from"./AutoAwesomeMotion-dbcbe853.js";import{D as H,d as I}from"./Cancel-6d100af1.js";import{D as M,a as G}from"./DialogContent-12401076.js";import{B as w}from"./Box-d340439b.js";import{G as x}from"./Grid-ca0b3039.js";import{D as K}from"./DialogActions-348b618d.js";import{T as ge,a as fe,b as be,c as _,d as u,e as xe,f as ye}from"./Edit-2e348e58.js";import{d as De}from"./DeleteOutline-36f06dde.js";import{q as k}from"./quanham-8ec7f94c.js";import"./DialogContentText-7d9104ba.js";const ve=h.forwardRef(function(n,r){return e(L,{direction:"up",ref:r,...n})}),Se=N(E)({position:"absolute",right:"16px",top:"4px"}),Ce=P({capham:$().required("Lỗi: Vui lòng nhập tên cấp bậc hàm"),thutu:z().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1"),nienhanlenham:z().required("Lỗi: Vui lòng nhập niên hạn lên cấp bậc hàm tiếp theo")}).required();function Te({open:m,onCloseDialogAdd:n,onSubmit:r}){const c=A({defaultValues:{capham:"",nienhanlenham:1,thutu:1},resolver:j(Ce)}),o=async l=>{r&&(await r(l),c.reset())},{isSubmitting:s}=c.formState;return e(F,{children:a(M,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(l,g)=>{g!=="backdropClick"&&n(l,g)},open:m,TransitionComponent:ve,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[a(H,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới cấp bậc hàm"}),e(Se,{onClick:()=>n(),children:e(I,{style:{color:"#d32b2b"}})})]}),e(G,{children:a(w,{children:[s?e(R,{}):"",a("form",{onSubmit:c.handleSubmit(o),style:{width:"100%"},children:[a(x,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(x,{item:!0,xs:12,md:6,lg:6,children:e(v,{name:"capham",form:c,label:"Tên cấp bậc hàm *",type:"text",disabled:!1})}),e(x,{item:!0,xs:12,md:3,lg:3,children:e(v,{name:"nienhanlenham",form:c,label:"Niên hạn lên quân hàm kế tiếp tính theo năm*",type:"number",disabled:!1})}),e(x,{item:!0,xs:12,md:3,lg:3,children:e(v,{name:"thutu",form:c,label:"Thứ tự",type:"number",disabled:!1})})]}),e(K,{children:a(C,{color:"primary",variant:"contained",disabled:s,type:"submit",style:{margin:"4px auto"},children:[e(O,{}),e("span",{children:"Thêm mới"})]})})]})]})})]})})}const ke=h.forwardRef(function(n,r){return e(L,{direction:"up",ref:r,...n})}),ze=N(E)({position:"absolute",right:"16px",top:"4px"}),qe=P({capham:$().required("Lỗi: Vui lòng nhập tên cấp bậc hàm"),thutu:z().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1"),nienhanlenham:z().required("Lỗi: Vui lòng nhập niên hạn lên cấp bậc hàm tiếp theo")}).required();function Oe({open:m,item:n,onCloseDialogEdit:r,onSubmit:c}){const o=A({defaultValues:{capham:"",nienhanlenham:1,thutu:1},resolver:j(qe)}),s=o.setValue;h.useEffect(()=>{n&&(s("capham",n.capham,{shouldValidate:!0}),s("thutu",n.thutu,{shouldValidate:!0}),s("nienhanlenham",n.nienhanlenham,{shouldValidate:!0}))},[n]);const l=async b=>{if(c){const f={...b,id_edit:n._id};await c(f),r()}},{isSubmitting:g}=o.formState;return e(F,{children:a(M,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(b,f)=>{f!=="backdropClick"&&r(b,f)},open:m,TransitionComponent:ke,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[a(H,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa cấp bậc hàm"}),e(ze,{onClick:()=>r(),children:e(I,{style:{color:"#d32b2b"}})})]}),e(G,{children:a(w,{children:[g?e(R,{}):"",a("form",{onSubmit:o.handleSubmit(l),style:{width:"100%"},children:[a(x,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(x,{item:!0,xs:12,md:6,lg:6,children:e(v,{name:"capham",form:o,label:"Tên cấp bậc hàm *",type:"text",disabled:!1})}),e(x,{item:!0,xs:12,md:3,lg:3,children:e(v,{name:"nienhanlenham",form:o,label:"Niên hạn lên quân hàm kế tiếp tính theo năm*",type:"number",disabled:!1})}),e(x,{item:!0,xs:12,md:3,lg:3,children:e(v,{name:"thutu",form:o,label:"Thứ tự",type:"number",disabled:!1})})]}),e(K,{children:a(C,{color:"primary",variant:"contained",disabled:g,type:"submit",style:{margin:"4px auto"},children:[e(O,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}const we=({list:m,page:n,onClickOpenDialogDelete:r,onClickOpenDialogEdit:c,tongbanghi:o})=>{const s=Q(l=>l.authReducer.roles_x01);return a(w,{mt:4,children:[a("p",{className:"text-end my-2",children:["Tổng cộng có: ",e("span",{className:"text-xl font-bold",children:o})," bản ghi"]}),e(ge,{children:a(fe,{sx:{minWidth:650},"aria-label":"simple table",children:[e(be,{style:{backgroundColor:"#ed6c02"},children:a(_,{children:[e(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"#"}),e(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Tên cấp bậc hàm"}),e(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Niên hạn lên hàm kế tiếp ( tính theo năm )"}),e(u,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thứ tự"}),e(u,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thao tác"})]})}),e(xe,{children:m.map((l,g)=>a(_,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(u,{component:"th",scope:"row",children:(n-1)*5+1+g}),e(u,{align:"left",style:{fontWeight:"bold"},children:l.capham}),e(u,{align:"left",children:l.nienhanlenham}),e(u,{align:"left",children:l.thutu}),a(u,{align:"right",children:[s&&s.includes("sửa quân hàm")&&a(C,{variant:"contained",color:"success",size:"small",onClick:()=>c(l),children:[e(ye,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),s&&s.includes("xóa quân hàm")&&a(C,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>r(l._id),children:[e(De,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},l._id))})]})})]})},Me=()=>{const m=Q(t=>t.authReducer.roles_x01),[n,r]=h.useState({page:1,total:1});let[c,o]=se();const[s,l]=h.useState(0),[g,b]=h.useState([]),f=ce(),y=h.useMemo(()=>{const t=pe.parse(location.search);return{...t,page:Number(t.page)||1}},[location.search]),[S,T]=h.useState({status:!1,id_Delete:null}),[q,V]=h.useState({status:!1,item:null}),[X,B]=h.useState(!1),[J,D]=h.useState(!1),U=()=>{B(!1)},Y=t=>{B(!0)},{enqueueSnackbar:d}=he(),Z=t=>{r({...n,page:t});const i={...y,page:t};o(i)};h.useEffect(()=>{(async()=>{try{D(!0);let i=await k.getQuanham(y);b(i.data.donvis),r({page:i.data.page,total:i.data.total}),l(i.data.tongbanghi),D(!1)}catch(i){i.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),d(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),d(i.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1)}})()},[y]);const ee=async t=>{try{let i={...t,queryParams:y};D(!0);let p=await k.addQuanham(i);b(p.data.donvis),r({...n,total:p.data.total}),l(p.data.tongbanghi),D(!1),d("Thêm mới cấp bậc hàm thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(i){i.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),d(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),d(i.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1)}},te=t=>{T({status:!0,id_Delete:t})},ae=()=>{V({...q,status:!1})},ne=t=>{V({item:t,status:!0})},ie=()=>{T({...S,status:!1})},le=async t=>{const i={...t,queryParams:y};try{let p=await k.editQuanham(i);b(p.data.donvis),d(p.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(p){p.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),d(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),d(p.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},re=async()=>{try{let t=await k.deleteQuanham(S.id_Delete,y);b(t.data.donvis),l(t.data.tongbanghi);const i={...y,page:1};o(i),T({...S,status:!1}),d(t.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),d(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),d(t.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},oe=()=>{T({...S,status:!1})};return a("div",{className:"mx-2 bg-white pb-2 px-4",children:[e("img",{className:"w-[80px] m-auto mt-2 pt-2",src:"https://thuviensocongantinhhungyen.vercel.app/cong-an-hieu.png",alt:"anhnen"}),e("h3",{className:"text-xl text-gray-900 text-center font-bold",children:"Quản lý cấp bậc quân hàm và niên hạn lên hàm kế tiếp theo cấp bậc hàm trong lực lượng CAND"}),m&&m.includes("thêm quân hàm")&&e("div",{className:"text-end mb-4",children:a(C,{variant:"contained",onClick:Y,children:[e(O,{}),"Thêm mới cấp bậc hàm"]})}),e("div",{children:J?e(de,{variant:"rectangular",width:"100%",height:400}):e(we,{list:g,page:n.page,onClickOpenDialogDelete:te,onClickOpenDialogEdit:ne,tongbanghi:s})}),e(Te,{open:X,onCloseDialogAdd:U,onSubmit:ee}),e(Oe,{open:q.status,item:q.item,onCloseDialogEdit:ae,onSubmit:le}),e(ue,{open:S.status,onCloseDialogDelete:ie,onConfirmDelete:re,onCancelDelete:oe}),e(me,{page:n.page,totalPage:n.total,onChangePage:Z})]})};export{Me as default};
