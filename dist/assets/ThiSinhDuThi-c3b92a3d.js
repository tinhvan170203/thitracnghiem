import{r as g,j as e,S as X,s as Q,I as D,c as B,a as v,u as R,F as E,d as n,L as J,e as P,B as k,o as M,f as U,P as xe,H as ye,g as Te,i as Ce,h as Se,M as De}from"./index-897b79e8.js";import{c as j}from"./commonApi-e8ee1bc2.js";import{d as Pe}from"./Search-188dbd75.js";import{d as ke}from"./Backspace-540db84c.js";import{q as _e}from"./base-312a79a2.js";import"./dayjs.min-31cc1409.js";import{M as Ne}from"./ModalLoading-56645adc.js";import{d as A}from"./Add-1dba506b.js";import{d as Ve}from"./Dashboard-5233e40d.js";import{m as z}from"./monthiApi-44e9b4df.js";import{S as we}from"./index-67c9bdd9.js";import{d as Y}from"./AutoAwesomeMotion-86657754.js";import{D as Z,d as ee}from"./Cancel-ca0ff035.js";import{S as N}from"./index-6a5ff801.js";import{D as ne,a as ae}from"./DialogContent-c9860ba1.js";import{B as F}from"./Box-982f9e7e.js";import{G as b}from"./Grid-d56384dd.js";import{D as te}from"./DialogActions-bcc417ef.js";import{p as L}from"./index-4d501b15.js";import{T as qe,d as H,a as W,b as G,c as K}from"./LastPage-003d166e.js";import{c as O,d as p,f as ze,T as Le,a as $e,b as Oe,e as Be}from"./Edit-6c104f4f.js";import{d as Re}from"./DeleteOutline-75910487.js";import{D as Ee}from"./DialogDelete-6884120a.js";import{C as Me,d as Ae}from"./index-e5a09b1e.js";import"./axiosCommon-88e84c8c.js";import"./MenuItem-ba894032.js";import"./KeyboardArrowRight-774d5ff6.js";import"./Toolbar-eebefd1a.js";import"./DialogContentText-481f1de1.js";const Fe=g.forwardRef(function(o,a){return e(X,{direction:"up",ref:a,...o})}),Ie=Q(D)({position:"absolute",right:"16px",top:"4px"}),je=B({hoten:v().required("Lỗi: Vui lòng nhập họ tên thí sinh"),sbd:v().required("Lỗi: Vui lòng nhập số báo danh"),donvi:v().required("Lỗi: Vui lòng chọn đơn vị công tác"),capbac:v().required("Lỗi: Vui lòng chọn cấp bậc hàm"),chucvu:v().required("Lỗi: Vui lòng chọn chức vụ"),namsinh:v().required("Lỗi: Vui lòng nhập năm sinh")}).required();function He({open:l,onCloseDialogAdd:o,onSubmit:a,donviList:r}){const s=R({defaultValues:{hoten:"",sbd:"",donvi:"",namsinh:"1996",capbac:"",chucvu:""},resolver:M(je)}),t=async c=>{a&&(await a(c),s.reset())},{isSubmitting:d}=s.formState;return e(E,{children:n(ne,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(c,x)=>{x!=="backdropClick"&&o(c,x)},open:l,TransitionComponent:Fe,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(Z,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(Y,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới thí sinh dự thi"}),e(Ie,{onClick:()=>o(),children:e(ee,{style:{color:"#d32b2b"}})})]}),e(ae,{children:n(F,{children:[d?e(J,{}):"",n("form",{onSubmit:s.handleSubmit(t),style:{width:"100%"},children:[n(b,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"hoten",form:s,label:"Họ và tên *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"sbd",form:s,label:"Số báo danh *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"namsinh",form:s,label:"Năm sinh *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"capbac",form:s,label:"Cấp bậc hàm *",disabled:!1,options:[{value:"Trung sĩ",label:"Trung sĩ"},{value:"Thượng sĩ",label:"Thượng sĩ"},{value:"Thiếu úy",label:"Thiếu úy"},{value:"Trung úy",label:"Trung úy"},{value:"Thượng úy",label:"Thượng úy"},{value:"Đại úy",label:"Đại úy"},{value:"Thiếu tá",label:"Thiếu tá"},{value:"Trung tá",label:"Trung tá"},{value:"Thượng tá",label:"Thượng tá"},{value:"Đại tá",label:"Đại tá"}]})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"chucvu",form:s,label:"Chức vụ công tác *",disabled:!1,options:[{value:"Chiến sĩ",label:"Chiến sĩ"},{value:"Cán bộ",label:"Cán bộ"},{value:"Phó đội trưởng và tương đương",label:"Phó đội trưởng và tương đương"},{value:"Đội trưởng và tương đương",label:"Đội trưởng và tương đương"},{value:"Phó Trưởng Công an xã",label:"Phó Trưởng Công an xã"},{value:"Trưởng Công an xã",label:"Trưởng Công an xã"},{value:"Phó Trưởng Công an huyện, thị, thành phố",label:"Phó Trưởng Công an huyện, thị, thành phố"},{value:"Trưởng Công an huyện, thị, thành phố",label:"Trưởng Công an huyện, thị, thành phố"},{value:"Phó Trưởng phòng",label:"Phó Trưởng phòng"},{value:"Trưởng phòng",label:"Trưởng phòng"}]})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"donvi",form:s,label:"Đơn vị công tác *",disabled:!1,options:r})})]}),e(te,{children:n(k,{color:"primary",variant:"contained",disabled:d,type:"submit",style:{margin:"4px auto"},children:[e(A,{}),e("span",{children:"Thêm mới thí sinh"})]})})]})]})})]})})}const We=({row:l,onClickOpenDialogEdit:o,onClickOpenDialogDelete:a})=>{g.useState(null);const r=U(s=>s.authReducer.roles_x01);return n(O,{children:[e(p,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:l.sbd}),e(p,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:l.hoten}),e(p,{className:"border-r border-slate-300",align:"left",children:l.namsinh}),e(p,{className:"border-r border-slate-300",align:"left",children:l.capbac}),e(p,{className:"border-r border-slate-300",align:"left",children:l.chucvu}),e(p,{className:"border-r border-slate-300",align:"left",children:l.donvi.kyhieu}),n(p,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1",style:{width:"180px"},children:[r&&r.includes("sửa thí sinh")&&e(k,{variant:"contained",color:"success",size:"small",onClick:()=>o(l),children:e(ze,{style:{fontSize:"20px"}})}),r&&r.includes("xóa thí sinh")&&e(k,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>a(l._id),children:e(Re,{style:{fontSize:"20px"}})})]})]},l._id)};function le(l){const o=ye(),{count:a,page:r,rowsPerPage:s,onPageChange:t}=l,d=h=>{t(h,0)},c=h=>{t(h,r-1)},x=h=>{t(h,r+1)},y=h=>{t(h,Math.max(0,Math.ceil(a/s)-1))};return n(F,{sx:{flexShrink:0,ml:2.5},children:[e(D,{onClick:d,disabled:r===0,"aria-label":"first page",children:o.direction==="rtl"?e(H,{}):e(W,{})}),e(D,{onClick:c,disabled:r===0,"aria-label":"previous page",children:o.direction==="rtl"?e(G,{}):e(K,{})}),e(D,{onClick:x,disabled:r>=Math.ceil(a/s)-1,"aria-label":"next page",children:o.direction==="rtl"?e(K,{}):e(G,{})}),e(D,{onClick:y,disabled:r>=Math.ceil(a/s)-1,"aria-label":"last page",children:o.direction==="rtl"?e(W,{}):e(H,{})})]})}le.propTypes={count:L.number.isRequired,onPageChange:L.func.isRequired,page:L.number.isRequired,rowsPerPage:L.number.isRequired};function Ge({list:l,onClickOpenDialogEdit:o,onClickOpenDialogDelete:a}){const[r,s]=g.useState(0),[t,d]=g.useState(10),c=r>0?Math.max(0,(1+r)*t-l.length):0,x=(h,C)=>{s(C)},y=h=>{d(parseInt(h.target.value,10)),s(0)};return n(E,{children:[e(Le,{component:xe,children:n($e,{"aria-label":"custom pagination table",children:[e(Oe,{children:n(O,{children:[e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"SBD"}),e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Họ tên"}),e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Năm sinh"}),e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Cấp bậc"}),e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Chức vụ"}),e(p,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Đơn vị công tác"}),e(p,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2",maxWidth:"150px"},children:"Thao tác"})]})}),n(Be,{children:[(t>0?l.slice(r*t,r*t+t):l).map(h=>e(We,{row:h,onClickOpenDialogEdit:o,onClickOpenDialogDelete:a},h._id)),c>0&&e(O,{style:{height:53*c},children:e(p,{colSpan:6})})]})]})}),e("div",{children:e(qe,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:l.length,rowsPerPage:t,page:r,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:x,onRowsPerPageChange:y,ActionsComponent:le,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:C,to:S,count:V}){return`hiển thị ${C} đến ${S} bản ghi trong tổng số ${V!==-1?V:`more than ${S}`} bản ghi`}})})]})}const Ke=g.forwardRef(function(o,a){return e(X,{direction:"up",ref:a,...o})}),Xe=Q(D)({position:"absolute",right:"16px",top:"4px"}),Qe=B({hoten:v().required("Lỗi: Vui lòng nhập họ tên thí sinh"),sbd:v().required("Lỗi: Vui lòng nhập số báo danh"),capbac:v().required("Lỗi: Vui lòng chọn cấp hàm"),chucvu:v().required("Lỗi: Vui lòng chọn chức vụ"),donvi:v().required("Lỗi: Vui lòng chọn đơn vị công tác"),namsinh:v().required("Lỗi: Vui lòng nhập năm sinh")}).required();function Je({open:l,onCloseDialogEdit:o,item:a,onSubmit:r,donviList:s}){const t=R({defaultValues:{hoten:"",sbd:"",donvi:"",namsinh:"1996",capbac:"Trung úy",chucvu:"Chiến sĩ"},resolver:M(Qe)}),d=t.setValue;g.useEffect(()=>{a&&(d("hoten",a.hoten,{shouldValidate:!0}),d("sbd",a.sbd,{shouldValidate:!0}),d("namsinh",a.namsinh,{shouldValidate:!0}),d("donvi",a.donvi._id,{shouldValidate:!0}),d("capbac",a.capbac,{shouldValidate:!0}),d("chucvu",a.chucvu,{shouldValidate:!0}))},[a]);const c=async y=>{if(r){const h={...y,id_edit:a._id};await r(h),o()}},{isSubmitting:x}=t.formState;return e(E,{children:n(ne,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(y,h)=>{h!=="backdropClick"&&o(y,h)},open:l,TransitionComponent:Ke,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(Z,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(Y,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa thông tin thí sinh"}),e(Xe,{onClick:()=>o(),children:e(ee,{style:{color:"#d32b2b"}})})]}),e(ae,{children:n(F,{children:[x?e(J,{}):"",n("form",{onSubmit:t.handleSubmit(c),style:{width:"100%"},children:[n(b,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"hoten",form:t,label:"Họ và tên *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"sbd",form:t,label:"Số báo danh *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(P,{name:"namsinh",form:t,label:"Năm sinh *",type:"text",disabled:!1})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"capbac",form:t,label:"Cấp bậc hàm *",disabled:!1,options:[{value:"Trung sĩ",label:"Trung sĩ"},{value:"Thượng sĩ",label:"Thượng sĩ"},{value:"Thiếu úy",label:"Thiếu úy"},{value:"Trung úy",label:"Trung úy"},{value:"Thượng úy",label:"Thượng úy"},{value:"Đại úy",label:"Đại úy"},{value:"Thiếu tá",label:"Thiếu tá"},{value:"Trung tá",label:"Trung tá"},{value:"Thượng tá",label:"Thượng tá"},{value:"Đại tá",label:"Đại tá"}]})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"chucvu",form:t,label:"Chức vụ công tác *",disabled:!1,options:[{value:"Chiến sĩ",label:"Chiến sĩ"},{value:"Cán bộ",label:"Cán bộ"},{value:"Phó đội trưởng và tương đương",label:"Phó đội trưởng và tương đương"},{value:"Đội trưởng và tương đương",label:"Đội trưởng và tương đương"},{value:"Phó Trưởng Công an xã",label:"Phó Trưởng Công an xã"},{value:"Trưởng Công an xã",label:"Trưởng Công an xã"},{value:"Phó Trưởng Công an huyện, thị, thành phố",label:"Phó Trưởng Công an huyện, thị, thành phố"},{value:"Trưởng Công an huyện, thị, thành phố",label:"Trưởng Công an huyện, thị, thành phố"},{value:"Phó Trưởng phòng",label:"Phó Trưởng phòng"},{value:"Trưởng phòng",label:"Trưởng phòng"}]})}),e(b,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"donvi",form:t,label:"Đơn vị công tác *",disabled:!1,options:s})})]}),e(te,{children:n(k,{color:"primary",variant:"contained",disabled:x,type:"submit",style:{margin:"4px auto"},children:[e(A,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}let Ue=[{label:"SBD",key:"sbd"},{label:"Họ tên",key:"hoten"},{label:"Cấp bậc",key:"capbac"},{label:"Chức vụ",key:"chucvu"},{label:"Đơn vị",key:"donvi.kyhieu"}];const Ye=B({}).required(),Vn=()=>{const l=R({defaultValues:{hoten:"",donvi:""},resolver:M(Ye)}),o=U(i=>i.authReducer.roles_x01),[a,r]=g.useState([]);g.useState(null);const[s,t]=g.useState([]),d=Te(),{enqueueSnackbar:c}=Ce();let[x,y]=Se();const[h,C]=g.useState(!1),[S,V]=g.useState({status:!1,item:null}),ie=i=>{V({item:i,status:!0})},re=()=>{V({...S,status:!1})},[w,q]=g.useState({status:!1,id_Delete:null}),se=i=>{q({status:!0,id_Delete:i})},oe=()=>{q({...w,status:!1})},ce=()=>{q({...w,status:!1})},_=g.useMemo(()=>{const i=_e.parse(location.search);return{...i,hoten:i.hoten||"",donvi:i.donvi||""}},[location.search]),{id:T}=De(),[m,he]=g.useState(null);g.useEffect(()=>{(async(u,f)=>{try{let $=await j.getInfoCuocthi(T);he($.data)}catch($){console.log($.message)}})()},[T]),g.useEffect(()=>{(async()=>{try{let u=await j.getDanhsachDonvi();r(u.data.donvis.map(f=>({value:f._id,label:f.tendonvi})))}catch(u){console.log(u.message)}})()},[]),g.useEffect(()=>{T&&(async()=>{try{C(!0);let u=await z.getThisinhs({..._,id_cuocthi:T});t(u.data),setTimeout(()=>{C(!1)},1e3)}catch(u){u.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(d("/login"),c(u.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),c(u.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}})()},[T,_]);const de=async i=>{y({..._,...i})},ue=()=>{l.reset()},[ge,I]=g.useState(!1),me=()=>{I(!1)},pe=()=>{I(!0)},be=async i=>{try{let u={...i,queryParams:_},f=await z.addThisinh(T,u);t(f.data.items),c("Thêm mới thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(u){u.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(d("/login"),c(u.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),c(u.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C(!1)}},fe=async i=>{const u={...i,queryParams:_,id_cuocthi:T,id_thisinh:i.id_edit};try{let f=await z.editThisinh(u);t(f.data.items),c(f.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(f){f.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(d("/login"),c(f.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),c(f.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},ve=async()=>{try{let i=await z.deleteThisinh(T,w.id_Delete,{..._});t(i.data.items),q({...w,status:!1}),c(i.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(i){i.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(d("/login"),c(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),c(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}};return n("div",{className:"mx-2 bg-white pb-2 px-4 shadow-2xl",children:[n("div",{className:"py-4 ml-4 mt-2",children:[n("h3",{className:"flex items-center space-x-2",children:[e(Ve,{}),e("span",{className:"text-lg font-semibold",children:"Quản lý thí sinh dự thi"})]}),e("div",{className:"mt-4 pl-4",children:n("div",{children:[n("p",{children:["Môn thi: ",m==null?void 0:m.monthi.tenmonthi]}),n("p",{children:["Cuộc thi: ",m==null?void 0:m.tencuocthi]}),n("p",{children:["Số lượng câu hỏi: ",m==null?void 0:m.soluongcauhoi]}),n("p",{children:["Thời gian làm bài: ",m==null?void 0:m.thoigianthi," phút"]})]})}),e("form",{onSubmit:l.handleSubmit(de),className:"bg-gray-100 rounded-xl mt-8",children:n("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[e("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu thí sinh dự thi:"}),n("div",{className:"flex flex-col p-4 md:flex-1 md:flex-wrap md:flex-row",children:[e("div",{className:"px-1 basis-1/2",children:e(P,{name:"hoten",form:l,label:"Họ và tên",type:"text",disabled:!1})}),e("div",{className:"px-1 basis-1/2",children:e(we,{name:"donvi",form:l,label:"Đơn vị công tác",disabled:!1,options:a})})]}),n("div",{className:"flex px-4 flex-col space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[n(k,{color:"primary",variant:"contained",type:"submit",children:[e(Pe,{}),e("span",{children:"Tìm kiếm thí sinh"})]}),n(k,{variant:"contained",onClick:ue,color:"warning",children:[e("span",{className:"mr-2",children:"Xóa trắng"}),e(ke,{})]})]})]})}),o&&o.includes("thêm thí sinh")&&e("div",{className:"text-end mb-4 mt-8",children:n(k,{variant:"contained",onClick:pe,children:[e(A,{}),"Thêm mới thí sinh"]})}),h&&e(Ne,{open:h})]}),e(He,{open:ge,onCloseDialogAdd:me,onSubmit:be,donviList:a}),e("div",{className:"text-end mb-2",children:e(D,{children:e(Me,{data:s,headers:Ue,filename:`danhsachthisinh_${m==null?void 0:m.tencuocthi}`,children:n("div",{className:"flex items-center shadow-md space-x-2 bg-green-300 px-2 py-1 rounded-md",children:[e(Ae,{}),e("span",{className:"text-sm text-green-800",children:"Xuất file excel"})]})})})}),e(Ge,{list:s,item:S.item,onClickOpenDialogDelete:se,onClickOpenDialogEdit:ie}),e(Je,{open:S.status,item:S.item,onCloseDialogEdit:re,onSubmit:fe,donviList:a}),e(Ee,{open:w.status,onCloseDialogDelete:oe,onConfirmDelete:ve,onCancelDelete:ce})]})};export{Vn as default};
