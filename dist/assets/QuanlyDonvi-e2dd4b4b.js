import{r as p,j as e,S as E,s as B,I as P,c as F,a as w,b as A,u as O,F as N,d as i,L as j,e as y,B as x,o as R,G as k,f as W,h as ce,g as he,i as ue}from"./index-7b6a1e29.js";import{S as ge,P as me}from"./PaginationComponent-bc16bb16.js";import{G as u,d as V,a as pe,b as fe}from"./Backspace-a55fb424.js";import{d as I}from"./AutoAwesomeMotion-4efc4403.js";import{D as K,a as M,d as G,b as Q}from"./Cancel-106abbd1.js";import{B as _}from"./Box-d34d2ebe.js";import{D as X}from"./DialogActions-75d297a3.js";import{T as ve,a as be,b as ye,c as L,d as v,e as xe,f as De}from"./Edit-eb8b4e5d.js";import{d as ke,D as Se}from"./DeleteOutline-10d37df2.js";import{q as Ce}from"./base-312a79a2.js";const Te=p.forwardRef(function(t,a){return e(E,{direction:"up",ref:a,...t})}),we=B(P)({position:"absolute",right:"16px",top:"4px"}),ze=F({tendonvi:w().required("Lỗi: Vui lòng nhập tên đơn vị"),kyhieu:w().required("Lỗi: Vui lòng nhập ký hiệu đơn vị"),thutu:A().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Oe({open:l,onCloseDialogAddDonvi:t,onSubmit:a}){const d=O({defaultValues:{tendonvi:"",kyhieu:"",thutu:1},resolver:R(ze)}),r=async c=>{a&&(await a(c),d.reset())},{isSubmitting:s}=d.formState;return e(N,{children:i(K,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(c,g)=>{g!=="backdropClick"&&t(c,g)},open:l,TransitionComponent:Te,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[i(M,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(I,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới đơn vị"}),e(we,{onClick:()=>t(),children:e(G,{style:{color:"#d32b2b"}})})]}),e(Q,{children:i(_,{children:[s?e(j,{}):"",i("form",{onSubmit:d.handleSubmit(r),style:{width:"100%"},children:[i(u,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:d,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:d,label:"Ký hiệu đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:d,label:"Thứ tự",type:"number",disabled:!1})})]}),e(X,{children:i(x,{color:"primary",variant:"contained",disabled:s,type:"submit",style:{margin:"4px auto"},children:[e(V,{}),e("span",{children:"Thêm mới"})]})})]})]})})]})})}const T={getDonvi(l){const t="api/donvi/fetch";return k.get(t,{params:l})},getDonviQuanly(l){const t="api/donviquanly/fetch";return k.get(t,{params:l})},addDonvi(l){const t="api/donvi/add";return k.post(t,l)},editDonvi(l){const t=`api/donvi/edit/${l.id_edit}`;return k.put(t,l)},deleteDonvi(l,t){const a=`api/donvi/delete/${l}`;return k.delete(a,{params:t})}},Ve=({donviList:l,page:t,onClickOpenDialogDelete:a,onClickOpenDialogEditDonvi:d})=>{const r=W(s=>s.authReducer.roles_x01);return e(_,{mt:4,children:e(ve,{children:i(be,{sx:{minWidth:650},"aria-label":"simple table",children:[e(ye,{style:{backgroundColor:"#1976d2"},children:i(L,{children:[e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"#"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Tên đơn vị"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Ký hiệu"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thứ tự"}),e(v,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thao tác"})]})}),e(xe,{children:l.map((s,c)=>i(L,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(v,{component:"th",scope:"row",children:(t-1)*5+1+c}),e(v,{align:"left",style:{fontWeight:"bold"},children:s.tendonvi}),e(v,{align:"left",children:s.kyhieu}),e(v,{align:"left",children:s.thutu}),i(v,{align:"right",children:[r&&r.includes("sửa đơn vị")&&i(x,{variant:"contained",color:"success",size:"small",onClick:()=>d(s),children:[e(De,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),r&&r.includes("xóa đơn vị")&&i(x,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>a(s._id),children:[e(ke,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},s._id))})]})})})},_e=p.forwardRef(function(t,a){return e(E,{direction:"up",ref:a,...t})}),$e=B(P)({position:"absolute",right:"16px",top:"4px"}),qe=F({tendonvi:w().required("Lỗi: Vui lòng nhập tên tài khoản"),kyhieu:w().required("Lỗi: Vui lòng nhập ký hiệu"),thutu:A().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Le({open:l,onCloseDialogEditDonvi:t,donvi:a,onSubmit:d}){const r=O({defaultValues:{tendonvi:"  ",kyhieu:" ",thutu:1},resolver:R(qe)}),s=r.setValue;p.useEffect(()=>{a&&(s("tendonvi",a.tendonvi,{shouldValidate:!0}),s("thutu",a.thutu,{shouldValidate:!0}),s("kyhieu",a.kyhieu,{shouldValidate:!0}))},[a]);const c=async h=>{if(d){const f={...h,id_edit:a._id};await d(f),t()}},{isSubmitting:g}=r.formState;return e(N,{children:i(K,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(h,f)=>{f!=="backdropClick"&&t(h,f)},open:l,TransitionComponent:_e,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[i(M,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(I,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa đơn vị"}),e($e,{onClick:()=>t(),children:e(G,{style:{color:"#d32b2b"}})})]}),e(Q,{children:i(_,{children:[g?e(j,{}):"",i("form",{onSubmit:r.handleSubmit(c),style:{width:"100%"},children:[i(u,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:r,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:r,label:"Ký hiệu *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:r,label:"Thứ tự",type:"number",disabled:!1})})]}),e(X,{children:i(x,{color:"primary",variant:"contained",disabled:g,type:"submit",style:{margin:"4px auto"},children:[e(V,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}const Ke=()=>{const l=W(n=>n.authReducer.roles_x01),[t,a]=p.useState({page:1,total:1});let[d,r]=ce();const[s,c]=p.useState([]),g=he(),h=p.useMemo(()=>{const n=Ce.parse(location.search);return{...n,kyhieu:n.kyhieu||"",tendonvi:n.tendonvi||"",page:Number(n.page)||1}},[location.search]),[f,S]=p.useState({status:!1,id_Delete:null}),[z,$]=p.useState({status:!1,donvi:null}),[H,q]=p.useState(!1),[J,D]=p.useState(!1),U=()=>{q(!1)},Y=()=>{q(!0)},{enqueueSnackbar:m}=ue(),C=O({defaultValues:{tendonvi:"",kyhieu:""}}),Z=n=>{a({...t,page:n});const o={...h,page:n};r(o)},ee=async n=>{r({...h,...n,page:1})};p.useEffect(()=>{(async()=>{try{D(!0);let o=await T.getDonvi(h);c(o.data.donvis),a({page:o.data.page,total:o.data.total}),D(!1)}catch(o){o.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),m(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1)}})()},[h]);const te=async n=>{try{let o={...n,queryParams:h};D(!0);let b=await T.addDonvi(o);c(b.data.donvis),a({...t,total:b.data.total}),D(!1),m("Thêm mới đơn vị thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(o){o.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),m(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1),g("/login")}},ne=()=>{C.reset()},ie=n=>{S({status:!0,id_Delete:n})},ae=()=>{$({...z,status:!1})},le=n=>{$({donvi:n,status:!0})},oe=()=>{S({...f,status:!1})},re=async n=>{const o={...n,queryParams:h};try{let b=await T.editDonvi(o);c(b.data.donvis),m(b.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(b){b.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),m(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},se=async()=>{try{let n=await T.deleteDonvi(f.id_Delete,h);c(n.data.donvis),a({total:n.data.total});const o={...h,page:1};r(o),S({...f,status:!1}),m(n.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(n){n.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),m(n.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(n.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},de=()=>{S({...f,status:!1})};return i("div",{className:"mx-2 bg-white pb-2 px-4",children:[e("h3",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[18px]",children:"Quản lý tên đơn vị cấp phòng, huyện và tương đương"}),l&&l.includes("thêm đơn vị")&&e("div",{className:"text-end my-4",children:i(x,{variant:"contained",onClick:Y,children:[e(V,{}),"Thêm mới đơn vị"]})}),e("div",{className:"p-2 rounded-md shadow-lg",children:e("form",{onSubmit:C.handleSubmit(ee),style:{width:"100%"},children:i("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[e("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu đơn vị:"}),i(u,{container:!0,spacing:1,style:{padding:"16px"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",label:"Tên đơn vị",form:C,disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"kyhieu",label:"Ký hiệu của đơn vị",form:C,disabled:!1})}),e(u,{item:!0,xs:12,md:12,lg:12,children:i("div",{className:"flex flex-col space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[i(x,{color:"primary",variant:"contained",type:"submit",children:[e(pe,{}),e("span",{children:"Tìm kiếm"})]}),i(x,{variant:"contained",onClick:ne,color:"warning",children:[e("span",{className:"mr-2",children:"Xóa trắng"}),e(fe,{})]})]})})]})]})})}),e("div",{children:J?e(ge,{variant:"rectangular",width:"100%",height:400}):e(Ve,{donviList:s,page:t.page,onClickOpenDialogDelete:ie,onClickOpenDialogEditDonvi:le})}),e(Oe,{open:H,onCloseDialogAddDonvi:U,onSubmit:te}),e(Le,{open:z.status,donvi:z.donvi,onCloseDialogEditDonvi:ae,onSubmit:re}),e(Se,{open:f.status,onCloseDialogDelete:oe,onConfirmDelete:se,onCancelDelete:de}),e(me,{page:t.page,totalPage:t.total,onChangePage:Z})]})};export{Ke as default};
