import{r as c,j as t,S as B,s as L,I as P,c as q,a as F,b as N,u as O,F as A,d as n,L as R,e as y,B as D,o as j,f as W,g as I,h as mt,i as gt}from"./index-d7a9d146.js";import{S as ut,P as pt}from"./PaginationComponent-1c0c6a27.js";import{d as M}from"./Add-d0ec4414.js";import{d as ft}from"./Search-ea6a5c46.js";import{d as bt}from"./Backspace-a340e520.js";import{q as xt}from"./base-312a79a2.js";import{D as yt}from"./DialogDelete-cc72a296.js";import{d as K}from"./AutoAwesomeMotion-48fa26b9.js";import{D as X,d as G}from"./Cancel-2fbf4918.js";import{D as H,a as Q}from"./DialogContent-92029a8c.js";import{B as V}from"./Box-8bb7873d.js";import{G as h}from"./Grid-c843cb60.js";import{D as J}from"./DialogActions-f19e4b53.js";import{T as Dt,a as vt,b as St,c as $,d as f,e as Tt,f as Ct}from"./Edit-46ee4309.js";import{d as kt}from"./DeleteOutline-48404f0a.js";import{m as w}from"./monthiApi-75edc2a3.js";import"./DialogContentText-9d0fcfa3.js";const wt=c.forwardRef(function(o,a){return t(B,{direction:"up",ref:a,...o})}),zt=L(P)({position:"absolute",right:"16px",top:"4px"}),Ot=q({tenmonthi:F().required("Lỗi: Vui lòng nhập tên môn thi"),thutu:N().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Mt({open:u,onCloseDialogAddDonvi:o,onSubmit:a}){const d=O({defaultValues:{tenmonthi:"",mota:"",thutu:1},resolver:j(Ot)}),s=async r=>{a&&(await a(r),d.reset())},{isSubmitting:l}=d.formState;return t(A,{children:n(H,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(r,m)=>{m!=="backdropClick"&&o(r,m)},open:u,TransitionComponent:wt,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(X,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[t(K,{style:{color:"#333",fontSize:"32px"}}),t("span",{children:"Thêm mới tên môn thi"}),t(zt,{onClick:()=>o(),children:t(G,{style:{color:"#d32b2b"}})})]}),t(Q,{children:n(V,{children:[l?t(R,{}):"",n("form",{onSubmit:d.handleSubmit(s),style:{width:"100%"},children:[n(h,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[t(h,{item:!0,xs:12,md:4,lg:4,children:t(y,{name:"tenmonthi",form:d,label:"Tên môn thi *",type:"text",disabled:!1})}),t(h,{item:!0,xs:12,md:6,lg:6,children:t(y,{name:"mota",form:d,label:"Mô tả",type:"text",disabled:!1})}),t(h,{item:!0,xs:12,md:2,lg:2,children:t(y,{name:"thutu",form:d,label:"Thứ tự",type:"number",disabled:!1})})]}),t(J,{children:n(D,{color:"primary",variant:"contained",disabled:l,type:"submit",style:{margin:"4px auto"},children:[t(M,{}),t("span",{children:"Thêm mới"})]})})]})]})})]})})}const Vt=({donviList:u,page:o,onClickOpenDialogDelete:a,onClickOpenDialogEditDonvi:d,tongbanghi:s})=>{const l=W(r=>r.authReducer.roles_x01);return I(),n(V,{mt:4,children:[n("p",{className:"text-end my-2",children:["Tổng cộng có: ",t("span",{className:"text-xl font-bold",children:s})," bản ghi"]}),t(Dt,{children:n(vt,{sx:{minWidth:650},"aria-label":"simple table",children:[t(St,{style:{backgroundColor:"#1976d2"},children:n($,{children:[t(f,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"#"}),t(f,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Tên môn thi"}),t(f,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Mô tả"}),t(f,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thứ tự"}),t(f,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thao tác"})]})}),t(Tt,{children:u.map((r,m)=>n($,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[t(f,{component:"th",scope:"row",children:(o-1)*5+1+m}),t(f,{align:"left",style:{fontWeight:"bold"},children:r.tenmonthi}),t(f,{align:"left",children:r.mota}),t(f,{align:"left",children:r.thutu}),n(f,{align:"right",children:[l&&l.includes("sửa môn thi")&&n(D,{variant:"contained",color:"success",size:"small",onClick:()=>d(r),children:[t(Ct,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),l&&l.includes("xóa môn thi")&&n(D,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>a(r._id),children:[t(kt,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},r._id))})]})})]})},_t=c.forwardRef(function(o,a){return t(B,{direction:"up",ref:a,...o})}),Et=L(P)({position:"absolute",right:"16px",top:"4px"}),$t=q({tenmonthi:F().required("Lỗi: Vui lòng nhập tên môn thi"),thutu:N().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Bt({open:u,onCloseDialogEditDonvi:o,donvi:a,onSubmit:d}){const s=O({defaultValues:{tenmonthi:"",mota:"",thutu:1},resolver:j($t)}),l=s.setValue;c.useEffect(()=>{a&&(l("tenmonthi",a.tenmonthi,{shouldValidate:!0}),l("thutu",a.thutu,{shouldValidate:!0}),l("mota",a.mota,{shouldValidate:!0}))},[a]);const r=async S=>{if(d){const b={...S,id_edit:a._id};await d(b),o()}},{isSubmitting:m}=s.formState;return t(A,{children:n(H,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(S,b)=>{b!=="backdropClick"&&o(S,b)},open:u,TransitionComponent:_t,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(X,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[t(K,{style:{color:"#333",fontSize:"32px"}}),t("span",{children:"Chỉnh sửa đội nghiệp vụ, CAX"}),t(Et,{onClick:()=>o(),children:t(G,{style:{color:"#d32b2b"}})})]}),t(Q,{children:n(V,{children:[m?t(R,{}):"",n("form",{onSubmit:s.handleSubmit(r),style:{width:"100%"},children:[n(h,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[t(h,{item:!0,xs:12,md:4,lg:4,children:t(y,{name:"tenmonthi",form:s,label:"Tên đội, cax *",type:"text",disabled:!1})}),t(h,{item:!0,xs:12,md:6,lg:6,children:t(y,{name:"mota",form:s,label:"Ký hiệu *",type:"text",disabled:!1})}),t(h,{item:!0,xs:12,md:2,lg:2,children:t(y,{name:"thutu",form:s,label:"Thứ tự",type:"number",disabled:!1})})]}),t(J,{children:n(D,{color:"primary",variant:"contained",disabled:m,type:"submit",style:{margin:"4px auto"},children:[t(M,{}),t("span",{children:"Cập nhật"})]})})]})]})})]})})}const Yt=()=>{const u=W(e=>e.authReducer.roles_x01),[o,a]=c.useState({page:1,total:1});let[d,s]=mt();const l=I(),[r,m]=c.useState(0),[S,b]=c.useState([]),x=c.useMemo(()=>{const e=xt.parse(location.search);return{...e,mota:e.mota||"",tenmonthi:e.tenmonthi||"",page:Number(e.page)||1}},[location.search]),[T,C]=c.useState({status:!1,id_Delete:null}),[z,_]=c.useState({status:!1,donvi:null}),[U,E]=c.useState(!1),[Y,v]=c.useState(!1),Z=()=>{E(!1)},tt=e=>{E(!0)},{enqueueSnackbar:g}=gt(),k=O({defaultValues:{tenmonthi:"",mota:""}}),et=e=>{a({...o,page:e});const i={...x,page:e};s(i)},nt=async e=>{s({...x,...e,page:1})};c.useEffect(()=>{(async()=>{try{v(!0);let i=await w.getMonthi(x);b(i.data.donvis),a({page:i.data.page,total:i.data.total}),m(i.data.tongbanghi),v(!1)}catch(i){i.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(l("/login"),g(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),g(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),v(!1)}})()},[x]);const at=async e=>{try{let i={...e,queryParams:x};v(!0);let p=await w.addMonthi(i);b(p.data.donvis),a({...o,total:p.data.total}),m(p.data.tongbanghi),v(!1),g("Thêm mới môn thi thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(i){i.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(l("/login"),g(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),g(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),v(!1)}},it=()=>{k.reset()},ot=e=>{C({status:!0,id_Delete:e})},lt=()=>{_({...z,status:!1})},rt=e=>{_({donvi:e,status:!0})},st=()=>{C({...T,status:!1})},dt=async e=>{const i={...e,queryParams:x};try{let p=await w.editMonthi(i);b(p.data.donvis),g(p.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(p){p.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(l("/login"),g(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),g(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},ct=async()=>{try{let e=await w.deleteMonthi(T.id_Delete,x);b(e.data.donvis),m(e.data.tongbanghi),a({...o,total:e.data.total});const i={...x,page:1};s(i),C({...T,status:!1}),g(e.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(e){e.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(l("/login"),g(e.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),g(e.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},ht=()=>{C({...T,status:!1})};return n("div",{className:"mx-2 bg-white pb-2 px-4",children:[t("h3",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[18px]",children:"Quản lý môn thi nghiệp vụ"}),t("div",{className:"p-2 rounded-md shadow-lg",children:t("form",{onSubmit:k.handleSubmit(nt),style:{width:"100%"},children:n("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[t("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu môn thi:"}),n(h,{container:!0,spacing:1,style:{padding:"16px"},children:[t(h,{item:!0,xs:12,md:6,lg:6,children:t(y,{name:"tenmonthi",label:"Tên môn thi",form:k,disabled:!1})}),t(h,{item:!0,xs:12,md:6,lg:6,children:t(y,{name:"mota",label:"Mô tả",form:k,disabled:!1})}),t(h,{item:!0,xs:12,md:12,lg:12,children:n("div",{className:"flex flex-col space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[n(D,{color:"primary",variant:"contained",type:"submit",style:{marginRight:"4px"},children:[t(ft,{}),t("span",{children:"Tìm kiếm"})]}),n(D,{variant:"contained",onClick:it,color:"warning",children:[t("span",{className:"mr-2",children:"Xóa trắng"}),t(bt,{})]})]})})]})]})})}),u&&u.includes("thêm môn thi")&&t("div",{className:"text-end mb-4 mt-4",children:n(D,{variant:"contained",onClick:tt,children:[t(M,{}),"Thêm mới môn thi"]})}),t("div",{children:Y?t(ut,{variant:"rectangular",width:"100%",height:400}):t(Vt,{donviList:S,page:o.page,onClickOpenDialogDelete:ot,onClickOpenDialogEditDonvi:rt,tongbanghi:r})}),t(Mt,{open:U,onCloseDialogAddDonvi:Z,onSubmit:at}),t(Bt,{open:z.status,donvi:z.donvi,onCloseDialogEditDonvi:lt,onSubmit:dt}),t(yt,{open:T.status,onCloseDialogDelete:st,onConfirmDelete:ct,onCancelDelete:ht}),t(pt,{page:o.page,totalPage:o.total,onChangePage:et})]})};export{Yt as default};
