import{r as g,j as e,S as E,s as $,I as B,c as P,a as C,b as F,u as z,F as A,d as n,L as N,e as y,B as x,o as j,f as R,h as de,g as ce,i as he}from"./index-e0961e99.js";import{S as ue,P as me}from"./PaginationComponent-ee26d6e2.js";import{d as O}from"./Add-e2a4bdf3.js";import{d as W}from"./AutoAwesomeMotion-af10e1ab.js";import{D as I,d as K}from"./Cancel-144df7f9.js";import{D as M,a as G}from"./DialogContent-799bdaed.js";import{B as V}from"./Box-840ed356.js";import{G as h}from"./Grid-1a838762.js";import{D as Q}from"./DialogActions-57bf780a.js";import{d as ge}from"./Search-6361a175.js";import{d as T}from"./donviApi-a67c342c.js";import{d as pe}from"./Backspace-34756366.js";import{T as fe,a as ve,b as be,c as q,d as v,e as ye,f as xe}from"./Edit-5d2efbfb.js";import{d as De}from"./DeleteOutline-0af1bb5e.js";import{q as ke}from"./base-312a79a2.js";import{D as Se}from"./DialogDelete-a37a3243.js";import"./DialogContentText-97f9fab1.js";const Te=g.forwardRef(function(l,i){return e(E,{direction:"up",ref:i,...l})}),Ce=$(B)({position:"absolute",right:"16px",top:"4px"}),we=P({tendonvi:C().required("Lỗi: Vui lòng nhập tên đơn vị"),kyhieu:C().required("Lỗi: Vui lòng nhập ký hiệu đơn vị"),thutu:F().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function ze({open:p,onCloseDialogAddDonvi:l,onSubmit:i}){const s=z({defaultValues:{tendonvi:"",kyhieu:"",thutu:1},resolver:j(we)}),o=async d=>{i&&(await i(d),s.reset())},{isSubmitting:r}=s.formState;return e(A,{children:n(M,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(d,u)=>{u!=="backdropClick"&&l(d,u)},open:p,TransitionComponent:Te,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(I,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới đơn vị"}),e(Ce,{onClick:()=>l(),children:e(K,{style:{color:"#d32b2b"}})})]}),e(G,{children:n(V,{children:[r?e(N,{}):"",n("form",{onSubmit:s.handleSubmit(o),style:{width:"100%"},children:[n(h,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(h,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:s,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(h,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:s,label:"Ký hiệu đơn vị *",type:"text",disabled:!1})}),e(h,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:s,label:"Thứ tự",type:"number",disabled:!1})})]}),e(Q,{children:n(x,{color:"primary",variant:"contained",disabled:r,type:"submit",style:{margin:"4px auto"},children:[e(O,{}),e("span",{children:"Thêm mới"})]})})]})]})})]})})}const Oe=({donviList:p,page:l,onClickOpenDialogDelete:i,onClickOpenDialogEditDonvi:s})=>{const o=R(r=>r.authReducer.roles_x01);return e(V,{mt:4,children:e(fe,{children:n(ve,{sx:{minWidth:650},"aria-label":"simple table",children:[e(be,{style:{backgroundColor:"#1976d2"},children:n(q,{children:[e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"#"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Tên đơn vị"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Ký hiệu"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thứ tự"}),e(v,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thao tác"})]})}),e(ye,{children:p.map((r,d)=>n(q,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(v,{component:"th",scope:"row",children:(l-1)*5+1+d}),e(v,{align:"left",style:{fontWeight:"bold"},children:r.tendonvi}),e(v,{align:"left",children:r.kyhieu}),e(v,{align:"left",children:r.thutu}),n(v,{align:"right",children:[o&&o.includes("sửa đơn vị")&&n(x,{variant:"contained",color:"success",size:"small",onClick:()=>s(r),children:[e(xe,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),o&&o.includes("xóa đơn vị")&&n(x,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>i(r._id),children:[e(De,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},r._id))})]})})})},Ve=g.forwardRef(function(l,i){return e(E,{direction:"up",ref:i,...l})}),_e=$(B)({position:"absolute",right:"16px",top:"4px"}),Le=P({tendonvi:C().required("Lỗi: Vui lòng nhập tên tài khoản"),kyhieu:C().required("Lỗi: Vui lòng nhập ký hiệu"),thutu:F().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function qe({open:p,onCloseDialogEditDonvi:l,donvi:i,onSubmit:s}){const o=z({defaultValues:{tendonvi:"  ",kyhieu:" ",thutu:1},resolver:j(Le)}),r=o.setValue;g.useEffect(()=>{i&&(r("tendonvi",i.tendonvi,{shouldValidate:!0}),r("thutu",i.thutu,{shouldValidate:!0}),r("kyhieu",i.kyhieu,{shouldValidate:!0}))},[i]);const d=async c=>{if(s){const f={...c,id_edit:i._id};await s(f),l()}},{isSubmitting:u}=o.formState;return e(A,{children:n(M,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(c,f)=>{f!=="backdropClick"&&l(c,f)},open:p,TransitionComponent:Ve,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(I,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa đơn vị"}),e(_e,{onClick:()=>l(),children:e(K,{style:{color:"#d32b2b"}})})]}),e(G,{children:n(V,{children:[u?e(N,{}):"",n("form",{onSubmit:o.handleSubmit(d),style:{width:"100%"},children:[n(h,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(h,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:o,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(h,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:o,label:"Ký hiệu *",type:"text",disabled:!1})}),e(h,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:o,label:"Thứ tự",type:"number",disabled:!1})})]}),e(Q,{children:n(x,{color:"primary",variant:"contained",disabled:u,type:"submit",style:{margin:"4px auto"},children:[e(O,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}const Je=()=>{const p=R(t=>t.authReducer.roles_x01),[l,i]=g.useState({page:1,total:1});let[s,o]=de();const[r,d]=g.useState([]),u=ce(),c=g.useMemo(()=>{const t=ke.parse(location.search);return{...t,kyhieu:t.kyhieu||"",tendonvi:t.tendonvi||"",page:Number(t.page)||1}},[location.search]),[f,k]=g.useState({status:!1,id_Delete:null}),[w,_]=g.useState({status:!1,donvi:null}),[X,L]=g.useState(!1),[H,D]=g.useState(!1),J=()=>{L(!1)},U=()=>{L(!0)},{enqueueSnackbar:m}=he(),S=z({defaultValues:{tendonvi:"",kyhieu:""}}),Y=t=>{i({...l,page:t});const a={...c,page:t};o(a)},Z=async t=>{o({...c,...t,page:1})};g.useEffect(()=>{(async()=>{try{D(!0);let a=await T.getDonvi(c);d(a.data.donvis),i({page:a.data.page,total:a.data.total}),D(!1)}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(u("/login"),m(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1)}})()},[c]);const ee=async t=>{try{let a={...t,queryParams:c};D(!0);let b=await T.addDonvi(a);d(b.data.donvis),i({...l,total:b.data.total}),D(!1),m("Thêm mới đơn vị thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(u("/login"),m(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1),u("/login")}},te=()=>{S.reset()},ne=t=>{k({status:!0,id_Delete:t})},ie=()=>{_({...w,status:!1})},ae=t=>{_({donvi:t,status:!0})},le=()=>{k({...f,status:!1})},oe=async t=>{const a={...t,queryParams:c};try{let b=await T.editDonvi(a);d(b.data.donvis),m(b.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(b){b.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(u("/login"),m(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},re=async()=>{try{let t=await T.deleteDonvi(f.id_Delete,c);d(t.data.donvis),i({total:t.data.total});const a={...c,page:1};o(a),k({...f,status:!1}),m(t.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(u("/login"),m(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),m(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},se=()=>{k({...f,status:!1})};return n("div",{className:"mx-2 bg-white pb-2 px-4",children:[e("h3",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[18px]",children:"Quản lý tên đơn vị cấp phòng, huyện và tương đương"}),p&&p.includes("thêm đơn vị")&&e("div",{className:"text-end my-4",children:n(x,{variant:"contained",onClick:U,children:[e(O,{}),"Thêm mới đơn vị"]})}),e("div",{className:"p-2 rounded-md shadow-lg",children:e("form",{onSubmit:S.handleSubmit(Z),style:{width:"100%"},children:n("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[e("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu đơn vị:"}),n(h,{container:!0,spacing:1,style:{padding:"16px"},children:[e(h,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",label:"Tên đơn vị",form:S,disabled:!1})}),e(h,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"kyhieu",label:"Ký hiệu của đơn vị",form:S,disabled:!1})}),e(h,{item:!0,xs:12,md:12,lg:12,children:n("div",{className:"flex flex-col space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[n(x,{color:"primary",variant:"contained",type:"submit",children:[e(ge,{}),e("span",{children:"Tìm kiếm"})]}),n(x,{variant:"contained",onClick:te,color:"warning",children:[e("span",{className:"mr-2",children:"Xóa trắng"}),e(pe,{})]})]})})]})]})})}),e("div",{children:H?e(ue,{variant:"rectangular",width:"100%",height:400}):e(Oe,{donviList:r,page:l.page,onClickOpenDialogDelete:ne,onClickOpenDialogEditDonvi:ae})}),e(ze,{open:X,onCloseDialogAddDonvi:J,onSubmit:ee}),e(qe,{open:w.status,donvi:w.donvi,onCloseDialogEditDonvi:ie,onSubmit:oe}),e(Se,{open:f.status,onCloseDialogDelete:le,onConfirmDelete:re,onCancelDelete:se}),e(me,{page:l.page,totalPage:l.total,onChangePage:Y})]})};export{Je as default};
