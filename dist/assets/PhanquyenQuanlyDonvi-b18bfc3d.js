import{r as s,j as e,d as o,P as T,F as q,B as P,f as U,a6 as M,g as A,h as B,i as O,L as j,a5 as w}from"./index-062f957e.js";import{q as D}from"./base-312a79a2.js";import{T as F,a as Q,b as W,c as N,d as u,e as H,f as V}from"./Edit-863c701d.js";import{B as I}from"./Box-bf90436a.js";import{S as G,P as J}from"./PaginationComponent-ff799b5b.js";import{c as K}from"./commonApi-0cde8b65.js";import"./axiosCommon-bb0a1a26.js";function X({values:g,onHandleEdit:f,userTemp:r}){const[c,n]=s.useState([]),[l,b]=s.useState(!1);s.useEffect(()=>{n(g)},[g]),s.useEffect(()=>{if(r){let a=[];g.forEach(i=>{r.quantrinhomdonvi.map(h=>h._id).includes(i.name)?a.push({name:i.name,monthi:i.monthi,isChecked:!0}):a.push({name:i.name,monthi:i.monthi,isChecked:!1})}),n(a)}else n(g)},[r]);const x=a=>{const{name:i,checked:h}=a.target;if(i==="allSelect"){let y=c.map(p=>({...p,isChecked:h}));n(y)}else{let y=c.map(p=>p.name===i?{...p,isChecked:h}:p);n(y)}},v=async()=>{let a=[];c.forEach(h=>{h.isChecked===!0&&a.push(h.name)});let i={id_edit:r._id,quantrinhomdonvi:a};b(!0),await f(i),b(!1)};return e("div",{className:"p-2",children:o(T,{style:{padding:"16px"},children:[o("h3",{className:"text-md text-center mt-2 font-bold",children:["Nhóm đơn vị được quản lý ",r&&o(q,{children:["bởi người dùng ",r.tentaikhoan]})]}),e("div",{className:"text-end",children:e(P,{variant:"contained",size:"small",disabled:r===null||l,onClick:v,children:"Lưu phân quyền"})}),o("div",{children:[e("input",{type:"checkbox",checked:c.filter(a=>(a==null?void 0:a.isChecked)!==!0).length<1,name:"allSelect",value:"allSelect",onChange:x}),e("span",{className:"text-red-900 font-bold ml-1",children:"Tất cả"})]}),e("div",{className:"flex flex-wrap",children:c&&c.map((a,i)=>o("div",{className:"flex space-x-1 basis-1/3",children:[e("input",{type:"checkbox",checked:(a==null?void 0:a.isChecked)||!1,name:a.name,onChange:x}),e("span",{className:"text-black",children:a.monthi})]},a.name))})]})})}const Y=({userList:g,userTemp:f,page:r,onClickSettingRoleUser:c})=>{const n=U(l=>l.authReducer.roles_x01);return e(I,{mt:4,children:e(F,{children:o(Q,{sx:{minWidth:650},"aria-label":"simple table",children:[e(W,{children:o(N,{children:[e(u,{align:"left",style:{fontSize:"14px"},children:"#"}),e(u,{align:"left",style:{fontSize:"14px"},children:"Tên tài khoản"}),e(u,{align:"left",style:{fontSize:"14px"},children:"Quyền quản lý môn thi"}),e(u,{align:"right",style:{fontSize:"14px"},children:"Thao tác"})]})}),e(H,{children:g.map((l,b)=>o(N,{className:f&&l._id===f._id?"bg-gray-300":"",sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(u,{component:"th",scope:"row",children:(r-1)*5+1+b}),e(u,{align:"left",style:{fontWeight:"bold"},children:l.tentaikhoan}),e(u,{align:"left",children:l.quantrinhomdonvi.map(x=>x.tenmonthi).toString()}),e(u,{align:"right",style:{minWidth:"200px"},children:n&&n.includes("sửa phân quyền quản lý môn thi")&&o(P,{variant:"contained",color:"success",onClick:()=>c(l),size:"small",children:[e(V,{style:{fontSize:"20px",marginRight:"4px"}})," ","Phân quyền"]})})]},l._id))})]})})})},se=()=>{const[g,f]=s.useState(!0),[r,c]=s.useState([]),[n,l]=s.useState({page:1,total:1}),[b,x]=s.useState(!1),[v,a]=s.useState(null),i=M(),h=A();let[y,p]=B();const{enqueueSnackbar:S}=O(),k=s.useMemo(()=>{const d=D.parse(i.search);return{...d,page:Number(d.page)||1}},[i.search]),z=d=>{l({...n,page:d});const t={...k,page:d};p(t)},[E,_]=s.useState([]);s.useEffect(()=>{(async()=>{let t=await K.getAllMonthi();if(t&&t.data.length>0){let C=t.data.map(m=>({name:m._id,monthi:m.tenmonthi}));_(C)}})()},[]),s.useEffect(()=>{(async()=>{try{const t=await w.getUsers(k.page);console.log(t),c(t.data.users),l({page:Number(t.data.page),total:t.data.total}),f(!1)}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"?(S(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),h("/login")):(S(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),h("/login"))}})()},[k]);const L=d=>{a(d)},R=async d=>{let t=n.page;const C={...d,page:t};try{let m=await w.editQuanlydonvi(C);c(m.data.users),a(null),S(m.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(h("/login"),S(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),S(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}};return o("div",{className:"flex mx-2 space-x-1 sm:flex-wrap md:flex-nowrap",children:[o("div",{className:"lg:basis-1/2 md:basis-1/2 w-full bg-white px-4",children:[e("h1",{className:"text-xl text-gray-900 text-center mt-2 font-bold",children:"Phân quyền quản lý môn thi"}),b&&e(j,{}),g?e("div",{className:"mt-2",children:e(G,{variant:"rectangular",width:"100%",height:"450px"})}):o(q,{children:[e(Y,{userList:r,page:n.page,onClickSettingRoleUser:L,userTemp:v}),e(J,{page:n.page,totalPage:n.total,onChangePage:z})]})]}),e("div",{className:"lg:basis-1/2 md:basis-1/2 w-full bg-white",children:e(X,{userTemp:v,onHandleEdit:R,values:E})})]})};export{se as default};
