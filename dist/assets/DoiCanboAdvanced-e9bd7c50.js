import{X as $,j as e,S as oe,s as re,I as D,c as se,a as F,u as ce,o as de,ao as ge,r as d,f as he,d as a,F as pe,P as ue,B as y,L as me,e as fe,H as be}from"./index-062f957e.js";import{d as xe,a as ye}from"./SaveAlt-d521e76a.js";import{p as C}from"./index-4d501b15.js";import{T as De,d as V,a as A,b as W,c as j}from"./LastPage-d948916c.js";import{d as w}from"./dayjs.min-aac666db.js";import{T as ve,a as Ce,b as Se,c as R,d as r,e as Pe,f as ke}from"./Edit-863c701d.js";import{d as _e,a as Te,b as we}from"./DeleteOutline-948d5e41.js";import{d as Re}from"./AutoAwesomeMotion-31ff343a.js";import{D as O,d as E}from"./Cancel-8937e614.js";import{c as $e}from"./commonApi-0cde8b65.js";import{S as Ne}from"./index-aefdd792.js";import{D as Be}from"./index-eca20c5d.js";import{D as I,a as G}from"./DialogContent-f84fc6ad.js";import{B as Y}from"./Box-bf90436a.js";import{G as S}from"./Grid-a7040e01.js";import{D as ze}from"./DialogActions-f287847c.js";import"./KeyboardArrowRight-737b2a8a.js";import"./Toolbar-b498bb22.js";import"./MenuItem-e2fd54c1.js";import"./axiosCommon-bb0a1a26.js";const H=$.forwardRef(function(l,h){return e(oe,{direction:"up",ref:h,...l})}),qe=re(D)({position:"absolute",right:"16px",top:"4px"});function K(s){const l=be(),{count:h,page:g,rowsPerPage:n,onPageChange:u}=s,P=c=>{u(c,0)},b=c=>{u(c,g-1)},k=c=>{u(c,g+1)},x=c=>{u(c,Math.max(0,Math.ceil(h/n)-1))};return a(Y,{sx:{flexShrink:0,ml:2.5},children:[e(D,{onClick:P,disabled:g===0,"aria-label":"first page",children:l.direction==="rtl"?e(V,{}):e(A,{})}),e(D,{onClick:b,disabled:g===0,"aria-label":"previous page",children:l.direction==="rtl"?e(W,{}):e(j,{})}),e(D,{onClick:k,disabled:g>=Math.ceil(h/n)-1,"aria-label":"next page",children:l.direction==="rtl"?e(j,{}):e(W,{})}),e(D,{onClick:x,disabled:g>=Math.ceil(h/n)-1,"aria-label":"last page",children:l.direction==="rtl"?e(A,{}):e(V,{})})]})}K.propTypes={count:C.number.isRequired,onPageChange:C.func.isRequired,page:C.number.isRequired,rowsPerPage:C.number.isRequired};const Le=se({doi:F().required("Vui lòng chọn đội công tác"),ngayvedoi:F().required("Vui lòng chọn ngày về đơn vị công tác")}).required(),at=()=>{var L;const s=ce({defaultValues:{doi:"",ghichu:"",ngayvedoi:w(Date.now())},resolver:de(Le)}),{canbo:l,onHandleSubmitEditDoi:h,onHandleSubmitDeleteDoi:g}=ge(),[n,u]=d.useState([]),[P,b]=d.useState(!1),[k,x]=d.useState(!1),[c,X]=d.useState([]),[o,J]=d.useState(null),[Q,U]=d.useState(null),v=he(t=>t.authReducer.roles_x01),[m,N]=$.useState(0),[p,Z]=$.useState(10),B=m>0?Math.max(0,(1+m)*p-(n==null?void 0:n.length)):0,ee=(t,i)=>{N(i)},te=t=>{Z(parseInt(t.target.value,10)),N(0)},z=()=>{b(!1)},q=()=>{x(!1)},ae=t=>{b(!0),J(t)},ne=t=>{x(!0),U(t)};d.useEffect(()=>{u(l==null?void 0:l.doi)},[l]),d.useEffect(()=>{(async()=>{try{let i=await $e.getAllDoi();console.log(i.data[0].donvi.kyhieu),X(i.data.map(f=>({value:f._id,label:f.tendoi+" - "+f.donvi.kyhieu})))}catch(i){console.log(i.message)}})()},[]),d.useEffect(()=>{_("doi",(o==null?void 0:o.doi._id)||"",{shouldValidate:!0}),_("ngayvedoi",w(o==null?void 0:o.tungay),{shouldValidate:!0}),_("ghichu",(o==null?void 0:o.ghichu)||"",{shouldValidate:!0})},[o]);const _=s.setValue,{isSubmitting:T}=s.formState,ie=async t=>{let i={...t,id_edit:l._id,id_row:o._id};await h(i),b(!1)},le=async()=>{let t={id_delete:l._id,id_row:Q};await g(t),x(!1)};return a("div",{children:[e("i",{children:"Nhắc nhở: Khi thay đổi đội nghiệp vụ, công an xã, phường, thị trấn cần thay đổi cả đơn vị công tác đồng thời để tránh gây lỗi dữ liệu hệ thống."}),a("div",{className:"flex items-center space-x-2 mt-8 mb-4",children:[e(xe,{color:"info"}),e("span",{className:"text-md text-red-800 font-bold",children:"Lịch sử biến động đội công tác và tương đương trong quá trình công tác"})]}),(n==null?void 0:n.length)>0&&a(pe,{children:[e(ve,{component:ue,style:{overflowX:"scroll"},children:a(Ce,{"aria-label":"custom pagination table",children:[e(Se,{children:a(R,{children:[e(r,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#ed6c02",maxWidth:"250px"},children:"#"}),e(r,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#ed6c02",minWidth:"250px"},children:"Tên đội công tác, công an xã, phường, thị trấn"}),e(r,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#ed6c02",minWidth:"120px"},children:"Ngày có quyết định về đơn vị công tác"}),e(r,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#ed6c02",minWidth:"300px"},children:"Ghi chú"}),e(r,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#ed6c02"},children:"Thao tác"})]})}),a(Pe,{children:[(L=p>0?n==null?void 0:n.slice(m*p,m*p+p):n)==null?void 0:L.map((t,i)=>a(R,{children:[e(r,{className:"border-r border-slate-300",component:"th",scope:"row",children:m*p+i+1}),e(r,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t.doi.tendoi}),e(r,{className:"border-r border-slate-300",align:"left",children:w(t.tungay).format("DD/MM/YYYY")}),e(r,{className:"border-r border-slate-300",align:"left",children:t.ghichu}),a(r,{align:"right",className:"border-r border-slate-300",children:[v&&v.includes("sửa biến động đội")&&a(y,{variant:"contained",color:"success",size:"small",onClick:()=>ae(t),children:[e(ke,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),v&&v.includes("xóa biến động đội")&&a(y,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>ne(t._id),children:[e(_e,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},t._id)),B>0&&e(R,{style:{height:53*B},children:e(r,{colSpan:6})})]})]})}),e("div",{children:e(De,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:n==null?void 0:n.length,rowsPerPage:p,page:m,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:ee,onRowsPerPageChange:te,ActionsComponent:K,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:i,to:f,count:M}){return`hiển thị ${i} đến ${f} bản ghi trong tổng số ${M!==-1?M:`more than ${f}`} bản ghi`}})})]}),a(I,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(t,i)=>{i!=="backdropClick"&&z()},open:P,TransitionComponent:H,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[a(O,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(Re,{style:{color:"#333",fontSize:"32px"}}),e("span",{className:"text-red-800 font-semibold",children:"Thay đổi đội công tác nâng cao"}),e(qe,{onClick:()=>z(),children:e(E,{style:{color:`${T?"#ccc":"#d32b2b"}`}})})]}),e(G,{children:a(Y,{children:[T?e(me,{}):"",a("form",{onSubmit:s.handleSubmit(ie),style:{width:"100%"},children:[a(S,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(S,{item:!0,xs:12,md:6,lg:6,children:e(Ne,{name:"doi",form:s,label:"Đơn vị công tác *",disabled:!1,options:c})}),e(S,{item:!0,xs:12,md:6,lg:6,children:e(Be,{name:"ngayvedoi",form:s,label:"Ngày nhận quyết định công tác tại đơn vị *",disabled:!1})}),e(S,{item:!0,xs:12,md:12,lg:12,children:e(fe,{name:"ghichu",form:s,label:"Ghi chú",type:"text",disabled:!1})})]}),e(ze,{children:a(y,{color:"primary",variant:"contained",disabled:T,type:"submit",style:{margin:"4px auto"},children:[e(ye,{}),e("span",{className:"ml-2",children:"Lưu dữ liệu"})]})})]})]})})]}),a(I,{disableEscapeKeyDown:!0,onClose:(t,i)=>{i!=="backdropClick"&&q()},open:k,TransitionComponent:H,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[a(O,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(Te,{style:{color:"red",fontSize:"32px"}}),e("span",{children:"Bạn có chắc chắn muốn xóa lần thay đổi đơn vị này không?"})]}),e(G,{children:e("img",{className:"p-4 mx-auto",src:"https://www.iconexperience.com/_img/v_collection_png/256x256/shadow/garbage_delete.png",alt:"icon-trash"})}),a("div",{className:"flex justify-evenly pb-4",children:[a(y,{variant:"contained",color:"success",onClick:le,children:[e(we,{})," Đồng ý"]}),a(y,{variant:"contained",color:"error",onClick:()=>q(),children:[e(E,{})," Cancel"]})]})]})]})};export{at as default};
