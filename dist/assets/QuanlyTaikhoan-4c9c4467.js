import{r as h,d as g,j as e,L as F,B as w,P as ee,f as Q,a6 as te,g as ae,h as ne,U as ie,i as le,a7 as P,F as se,a5 as R,a8 as oe,a9 as he}from"./index-062f957e.js";import{c as _,d as i,T as j,a as B,b as I,e as M,f as re}from"./Edit-863c701d.js";import{d as ce}from"./DeleteOutline-948d5e41.js";import{B as ge}from"./Box-bf90436a.js";import{S as me,P as de}from"./PaginationComponent-ff799b5b.js";import{q as ue}from"./base-312a79a2.js";import{D as pe}from"./DialogDelete-8ca5256c.js";import"./Cancel-8937e614.js";import"./DialogContent-f84fc6ad.js";import"./DialogContentText-ef6c130a.js";function S({label:a,values:u,onChangeRoleList:r,userTemp:b}){const[d,c]=h.useState([]);h.useEffect(()=>{c(u)},[]),h.useEffect(()=>{if(b){let n=[];u.forEach(o=>{b.roles.includes(o.name)?n.push({name:o.name,isChecked:!0}):n.push({name:o.name,isChecked:!1})}),c(n)}else c(u)},[b]);const l=n=>{const{name:o,checked:v}=n.target;if(o==="allSelect"){let k=d.map(s=>({...s,isChecked:v}));c(k);let f=[],m=[];k.forEach(s=>{s.isChecked===!0?f.push(s.name):m.push(s.name)}),r(f,m)}else{let k=d.map(s=>s.name===o?{...s,isChecked:v}:s);c(k);let f=[],m=[];k.forEach(s=>{s.isChecked===!0?f.push(s.name):m.push(s.name)}),r(f,m)}};return g(_,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(i,{component:"th",scope:"row",children:e("span",{className:"font-bold",children:a})}),d&&d.map((n,o)=>e(i,{align:"right",children:e("input",{type:"checkbox",checked:(n==null?void 0:n.isChecked)||!1,name:n.name,onChange:l})},n.name)),e(i,{align:"right",children:e("input",{type:"checkbox",checked:d.filter(n=>(n==null?void 0:n.isChecked)!==!0).length<1,name:"allSelect",value:"allSelect",onChange:l})})]})}function fe({userTemp:a,onHandleEditUser:u}){let r=[];const[b,d]=h.useState([]),[c,l]=h.useState(!1);h.useEffect(()=>{d(a!==null?a.roles:[])},[a]);const n=async()=>{let v={id_edit:a._id,roles:b};l(!0),await u(v),l(!1),d([])},o=(v,k)=>{r=b,k.length>0&&k.forEach(f=>{let m=r.findIndex(s=>s===f);m!==-1&&r.splice(m,1)}),r=r.concat(v),r=Array.from(new Set(r)),d(r)};return g("div",{className:"px-2 py-4",children:[c&&e(F,{}),g("h3",{className:"text-center text-xl text-black font-bold",children:["Phân quyền cho tài khoản",e("span",{className:"ml-1",children:a&&a.tentaikhoan})]}),e("div",{className:"text-right mb-2",children:e(w,{variant:"contained",onClick:n,disabled:a===null||c,children:"Cập nhật"})}),e(j,{component:ee,children:g(B,{children:[e(I,{children:g(_,{children:[e(i,{}),e(i,{align:"right",children:"Xem"}),e(i,{align:"right",children:"Thêm"}),e(i,{align:"right",children:"Sửa"}),e(i,{align:"right",children:"Xóa"}),e(i,{align:"right",children:"Full"})]})}),g(M,{children:[e(S,{label:"QL tài khoản",values:[{name:"xem tài khoản"},{name:"thêm tài khoản"},{name:"sửa tài khoản"},{name:"xóa tài khoản"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"Phân quyền QL môn thi",values:[{name:"xem phân quyền quản lý môn thi"},{name:"thêm phân quyền quản lý môn thi"},{name:"sửa phân quyền quản lý môn thi"},{name:"xóa phân quyền quản lý môn thi"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"QL đơn vị",values:[{name:"xem đơn vị"},{name:"thêm đơn vị"},{name:"sửa đơn vị"},{name:"xóa đơn vị"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"QL môn thi",values:[{name:"xem môn thi"},{name:"thêm môn thi"},{name:"sửa môn thi"},{name:"xóa môn thi"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"QL cuộc thi",values:[{name:"xem cuộc thi"},{name:"thêm cuộc thi"},{name:"sửa cuộc thi"},{name:"xóa cuộc thi"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"QL thí sinh",values:[{name:"xem thí sinh"},{name:"thêm thí sinh"},{name:"sửa thí sinh"},{name:"xóa thí sinh"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"QL câu hỏi",values:[{name:"xem câu hỏi"},{name:"thêm câu hỏi"},{name:"sửa câu hỏi"},{name:"xóa câu hỏi"}],onChangeRoleList:o,userTemp:a}),e(S,{label:"Thay đổi trạng thái cuộc thi",values:[{name:"xem trạng thái cuộc thi"},{name:"thêm trạng thái cuộc thi"},{name:"sửa trạng thái cuộc thi"},{name:"xóa trạng thái cuộc thi"}],onChangeRoleList:o,userTemp:a})]})]})})]})}const be=({userList:a,userTemp:u,page:r,onClickOpenDialogDelete:b,onClickSettingRoleUser:d})=>{const c=Q(l=>l.authReducer.roles_x01);return e(ge,{mt:4,children:e(j,{children:g(B,{sx:{minWidth:650},"aria-label":"simple table",children:[e(I,{children:g(_,{children:[e(i,{align:"left",style:{fontSize:"14px"},children:"#"}),e(i,{align:"left",style:{fontSize:"14px"},children:"Tên tài khoản"}),e(i,{align:"left",style:{fontSize:"14px"},children:"Mật khẩu"}),e(i,{align:"left",style:{fontSize:"14px"},children:"Thứ tự"}),e(i,{align:"left",style:{fontSize:"14px"},children:"Quyền hệ thống"}),e(i,{align:"right",style:{fontSize:"14px"},children:"Thao tác"})]})}),e(M,{children:a.map((l,n)=>g(_,{className:u&&l._id===u._id?"bg-gray-300":"",sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(i,{component:"th",scope:"row",children:(r-1)*5+1+n}),e(i,{align:"left",style:{fontWeight:"bold"},children:l.tentaikhoan}),e(i,{align:"left",children:l.matkhau}),e(i,{align:"left",children:l.thutu}),e(i,{align:"left",children:l.roles.toString()}),g(i,{align:"right",style:{minWidth:"200px"},children:[c&&c.includes("sửa tài khoản")&&g(w,{variant:"contained",color:"success",onClick:()=>d(l),size:"small",children:[e(re,{style:{fontSize:"20px",marginRight:"4px"}})," ","Phân quyền"]}),c&&c.includes("xóa tài khoản")&&g(w,{variant:"contained",color:"error",size:"small",style:{marginTop:"4px"},onClick:()=>b(l._id),disabled:u&&l._id===u._id,children:[e(ce,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},l._id))})]})})})},xe=be;function Pe(){const[a,u]=h.useState(""),[r,b]=h.useState(""),[d,c]=h.useState(1),[l,n]=h.useState(!1),[o,v]=h.useState(!0),[k,f]=h.useState([]),[m,s]=h.useState({page:1,total:1}),[U,q]=h.useState(null),N=te(),C=ae();let[ke,O]=ne();const[L,z]=h.useState({status:!1,id_Delete:null});h.useState({status:!1,user:null});const V=ie(),T=Q(t=>t.authReducer.roles_x01),D=h.useMemo(()=>{const t=ue.parse(N.search);return{...t,page:Number(t.page)||1}},[N.search]),{enqueueSnackbar:x}=le(),A=()=>{z({...L,status:!1})},W=t=>{z({status:!0,id_Delete:t})},X=t=>{s({...m,page:t});const p={...D,page:t};O(p)},H=async()=>{try{n(!0);let t=await R.addUser({tentaikhoan:a,matkhau:r,thutu:d});n(!1),x("Thêm mới tài khoản thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"}),u(""),b(""),c(1),f(t.data.users),s({page:1,total:t.data.total})}catch(t){t.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),x(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),x(t.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},$=async t=>{let p=m.page;const E={...t,page:p};try{let y=await R.editUser(E);const Y=localStorage.getItem("accessToken_thitracnghiem"),Z=oe(Y);E.id_edit===Z.userId&&(console.log(t),V(he(t.roles))),f(y.data.users),q(null),x(y.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(y){y.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),x(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),x(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},G=async()=>{try{let t=await R.deleteUser(L.id_Delete);f(t.data.users),s({...m,page:1,total:t.data.total});const p={...D,page:1};O(p),z({...L,status:!1}),x(t.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),x(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),x(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},J=()=>{z({...L,status:!1})};h.useEffect(()=>{(async()=>{try{const p=await R.getUsers(D.page);f(p.data.users),s({page:Number(p.data.page),total:p.data.total}),v(!1)}catch(p){p.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"?(x(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login")):(x(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login"))}})()},[D]);const K=t=>{q(t)};return g("div",{className:"flex mx-2 space-x-1 sm:flex-wrap md:flex-nowrap",children:[g("div",{className:"lg:basis-2/3 md:basis-3/5 w-full bg-white px-4",children:[e("h1",{className:"text-xl text-gray-900 text-center mt-2 font-bold",children:"Quản lý tài khoản người dùng"}),l&&e(F,{}),T&&T.includes("thêm tài khoản")&&g("form",{className:"flex items-center space-x-4 justify-start mt-8",children:[e(P,{name:"tentaikhoan",label:"Tên tài khoản",value:a,onChange:t=>u(t.target.value),size:"small"}),e(P,{name:"matkhau",label:"Mật khẩu",value:r,onChange:t=>b(t.target.value),size:"small"}),e(P,{name:"thutu",label:"Thứ tự",value:d,onChange:t=>c(t.target.value),type:"number",size:"small"}),e(w,{onClick:H,variant:"contained",disabled:l,children:"Thêm mới"})]}),o?e("div",{className:"mt-2",children:e(me,{variant:"rectangular",width:"100%",height:"450px"})}):g(se,{children:[e(xe,{userList:k,page:m.page,onClickOpenDialogDelete:W,onClickSettingRoleUser:K,userTemp:U}),e(de,{page:m.page,totalPage:m.total,onChangePage:X})]})]}),e("div",{className:"lg:basis-1/3 md:basis-2/5 w-full bg-white",children:e(fe,{userTemp:U,onHandleEditUser:$})}),e(pe,{open:L.status,onCloseDialogDelete:A,onConfirmDelete:G,onCancelDelete:J})]})}export{Pe as default};
